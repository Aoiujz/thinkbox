/**
 +-------------------------------------------------------------------
 * jQuery ThinkBox - 弹出层插件 - http://zjzit.cn/thinkbox
 +-------------------------------------------------------------------
 * @version    1.0.0beta
 * @since      2012.06.26
 * @author     麦当苗儿 <zuojiazi.cn@vip.qq.com>
 * @github     https://github.com/Aoiujz/ThinkBox.git
 +-------------------------------------------------------------------
 */
;(function(a){function i(){var b=this.options();var c=a(f);var d=a(".ThinkBox-title-inner",c).html("<span>"+b.title+"</span>");if(b.drag){d.addClass("dragging");d[0].onselectstart=function(){return false};d[0].unselectable="on";d[0].style.MozUserSelect="none";n.call(this,d)}a("tr",this.box()).first().after(c)}function j(){var b=this.options(),c=this;var d=a(g);var e=a(".ThinkBox-tools-inner",d);var f=null;a.each(b.button,function(b,d){f=a("<input/>").attr("type","button").addClass(b).val(d[0]).click(function(){c.hide();C.call(c,d[1])}).appendTo(e)});a("tr",this.box()).last().before(d)}function k(){var b=this;a('<a class="ThinkBox-close"></a>').click(function(a){b.hide();a.stopPropagation()}).mousedown(function(a){a.stopPropagation()}).appendTo(a(".ThinkBox-inner",this.box()))}function l(b){var c=this.options(),d=this.box();b=a("<div/>").addClass("ThinkBox-content").append(a(b).clone().show());a(".ThinkBox-content",d).remove();a(".ThinkBox-inner",d).css({width:c.width,height:c.height}).append(b)}function m(){var b=this.options(),c=this.box();b.center?p.call(this):q.call(this,a.isNumeric(b.x)?b.x:a.isFunction(b.x)?b.x.call(c):0,a.isNumeric(b.y)?b.y:a.isFunction(b.y)?b.y.call(c):0)}function n(b){var c=null,d=this.box(),e=this.options(),f=this;a(document).mousemove(function(a){c&&d.css({left:a.pageX-c[0],top:a.pageY-c[1]})});b.mousedown(function(b){var f=d.offset();if(e.fixed){f.left-=a(window).scrollLeft();f.top-=a(window).scrollTop()}c=[b.pageX-f.left,b.pageY-f.top]}).mouseup(function(){c=null;C.call(f,e.afterDrag)})}function p(){var a=this.box();s=r.call(this),v=B(),o=a.hasClass("fixed")?[0,0]:[v.left,v.top],x=o[0]+v.width/2,y=o[1]+v.height/2;q.call(this,x-s[0]/2,y-s[1]/2)}function q(b,c){var d=this.box(),e=this.options();a.isNumeric(b)&&(e.locate[0]=="left"?d.css({left:b}):d.css({right:b}));a.isNumeric(c)&&(e.locate[1]=="top"?d.css({top:c}):d.css({bottom:c}))}function r(){var a=this.box();if(this.visible())return[a.width(),a.height()];else{a.css({visibility:"hidden",display:"block"});var b=[a.width(),a.height()];a.css("display","none").css("visibility","visible");return b}}function t(){this.css({width:"",height:""});this.css({width:this.width(),height:this.height()})}function u(){var b=this.options();var e=a('<div class="ThinkBox-modal-blackout"></div>').addClass(b.style).css({zIndex:c++,width:a(document).width(),height:a(document).height()}).click(function(a){b.modalClose&&d&&d.hide();a.stopPropagation()}).mousedown(function(a){a.stopPropagation()}).appendTo(a("body"));a(window).resize(function(){e.css({width:"",height:""});e.css({width:a(document).width(),height:a(document).height()})});return e}function w(){this.css({zIndex:c++})}function z(){var b=this.options();C.call(this,b.beforeUnload);this.box().remove();b.dataEle&&a(b.dataEle).removeData("ThinkBox")}function A(){var a=this.box(),b=this;a.mousedown(function(c){d=b;w.call(a);c.stopPropagation()}).mousedown();a.click(function(a){a.stopPropagation()})}function B(){var b=a(window);return a.extend({width:b.width(),height:b.height()},{left:b.scrollLeft(),top:b.scrollTop()})}function C(b){a.isFunction(b)&&b.call(this)}function D(b,c){a.each(b,function(){if(this in c)delete c[this]})}var b={title:null,fixed:true,center:true,x:0,y:0,modal:false,modalClose:true,resize:true,unload:false,close:true,escHide:true,delayClose:0,drag:true,display:true,width:"",height:"",dataEle:"",locate:["left","top"],show:["fadeIn","normal"],hide:["fadeOut","normal"],style:"default",beforeShow:undefined,afterShow:undefined,afterHide:undefined,beforeUnload:undefined,afterDrag:undefined};var c=2012;var d=null;var e=['<div class="ThinkBox-wrapper">','<table cellspacing="0" cellpadding="0" border="0">',"<tr>",'<td class="box-top-left"></td>','<td class="box-top"></td>','<td class="box-top-right"></td>',"</tr>","<tr>",'<td class="box-left"></td>','<td class="ThinkBox-inner"></td>','<td class="box-right"></td>',"</tr>","<tr>",'<td class="box-bottom-left"></td>','<td class="box-bottom"></td>','<td class="box-bottom-right"></td>',"</tr>","</table>","</div>"].join("");var f=['<tr class="ThinkBox-title">','<td class="box-title-left"></td>','<td class="ThinkBox-title-inner"></td>','<td class="box-title-right"></td>',"</tr>"].join("");var g=['<tr class="ThinkBox-tools">','<td class="box-tools-left"></td>','<td class="ThinkBox-tools-inner"></td>','<td class="box-tools-right"></td>',"</tr>"].join("");var h=function(c,d){function o(){function b(){d.delayClose&&a.isNumeric(d.delayClose)&&setTimeout(p,d.delayClose);C.call(f,d.afterShow)}if(g)return this;d.modal&&(h=u.call(f));f.escHide=d.escHide;C.call(f,d.beforeShow);switch(d.show[0]){case"slideDown":n.stop().slideDown(d.show[1],b);break;case"fadeIn":n.stop().fadeIn(d.show[1],b);break;default:n.stop().show(d.show[1],b)}g=true;A.call(f);t.call(n);return this}function p(){function b(){g=false;C.call(f,d.afterHide);d.unload&&z.call(f)}if(!g)return;h&&h.fadeOut("normal",function(){a(this).remove();h=null});switch(d.hide[0]){case"slideUp":n.stop().slideUp(d.show[1],b);break;case"fadeOut":n.stop().fadeOut(d.show[1],b);break;default:n.stop().hide(d.show[1],b)}}var f=this,g=false,h=null;var d=a.extend({},b,d||{});var n=a(e).addClass(d.style).data("ThinkBox",this);d.dataEle&&a(d.dataEle).data("ThinkBox",this);this.box=function(){return n};this.options=function(){return d};this.visible=function(){return g};l.call(this,c||"<div></div>");d.title!==null&&i.call(this);d.button&&j.call(this);d.close&&k.call(f);n.css("display","none").appendTo("body");d.fixed&&(a.browser.msie&&a.browser.version<7?d.fixed=false:n.addClass("fixed"));m.call(this);d.resize&&a(window).resize(function(){m.call(f)});d.display&&o();this.hide=p;this.show=o;this.toggle=function(){g?f.hide():f.show()};this.getContent=function(){return a(".ThinkBox-content",n)};this.setContent=function(a){l.call(f,a);g&&t.call(n);m.call(f);return f};this.getSize=function(){return r.call(f)};this.setSize=function(b,c){a(".ThinkBox-inner",n).css({width:b,height:c})};};a(document).mousedown(function(){d=null}).keypress(function(a){d&&d.escHide&&a.keyCode==27&&d.hide()});a.ThinkBox=function(b,c){if(a.isPlainObject(c)&&c.dataEle){var d=a(c.dataEle).data("ThinkBox");if(d)return c.display===false?d:d.show()}return new h(b,c)};a.extend(a.ThinkBox,{load:function(b,c){var d={type:"GET",dataType:"text",cache:false,parseData:undefined};a.extend(d,c||{});var e=a.ThinkBox('<div class="ThinkBox-load-loading"></div>',d);if(!e.getContent().children().is(".ThinkBox-load-loading"))return e;var f={url:b,type:d.type,dataType:d.dataType,cache:d.cache,success:function(b){a.isFunction(d.parseData)&&(b=d.parseData(b));D(["type","cache","dataType","parseData"],d);e.setContent(b)}};a.ajax(f);return e},iframe:function(b,c){var d={width:500,height:400,scrolling:"no"};a.extend(d,c||{});var e='<iframe src="'+b+'" width="'+d.width+'" height="'+d.height+'" frameborder="0" scrolling="'+d.scrolling+'"></iframe>';delete d.width,delete d.height,delete d.scrolling;return a.ThinkBox(e,d)},tips:function(b,c,d){switch(c){case 0:c="error";break;case 1:c="success";break}var e='<div class="ThinkBox-tips ThinkBox-'+c+'">'+b+"</div>";var f={modal:false,escHide:false,unload:true,close:false,delayClose:1e3};a.extend(f,d||{});return a.ThinkBox(e,f)},success:function(a,b){return this.tips(a,"success",b)},error:function(a,b){return this.tips(a,"error",b)},loading:function(b,c){var d={modal:true,modalClose:false,delayClose:0};a.extend(d,c||{});return this.tips(b,"loading",d)},msg:function(b,c){var d='<div class="ThinkBox-msg">'+b+"</div>";var e={drag:false,escHide:false,delayClose:0,center:false,title:"消息",x:0,y:0,locate:["right","bottom"],show:["slideDown","slow"],hide:["slideUp","slow"]};a.extend(e,c||{});return a.ThinkBox(d,e)},alert:function(b,c){var d={title:"提示",modal:false,modalClose:false,unload:false,width:250,height:100},e={ok:["确定",undefined]};a.extend(d,c||{});typeof d.okValue!="undefined"&&(e.ok[0]=d.okValue);a.isFunction(d.okClick)&&(e.ok[1]=d.okClick);D(["okValue","okClick"],d);d.button=e;var f=a("<div/>").addClass("alert").html(b);return a.ThinkBox(f,d)},confirm:function(b,c){var d={title:"确认",modal:false,modalClose:false,width:250,height:100},e={ok:["确定",undefined],cancel:["取消",undefined]};a.extend(d,c||{});typeof d.okValue!="undefined"&&(e.ok[0]=d.okValue);typeof d.cancelValue!="undefined"&&(e.cancel[0]=d.cancelValue);a.isFunction(d.okClick)&&(e.ok[1]=d.okClick);a.isFunction(d.cancelClick)&&(e.cancel[1]=d.cancelClick);D(["okValue","okClick","cancelValue","cancelClick"],d);d.button=e;var f=a("<div/>").addClass("confirm").html(b);return a.ThinkBox(f,d)},get:function(b){return a(b).parents(".ThinkBox-wrapper").data("ThinkBox")}});a.fn.ThinkBox=function(b){function c(b){var c=this.attr("href");if(c.substr(0,1)=="#"){a.ThinkBox(c,b)}else{a.ThinkBox.load(c,b)}}if(b=="get")return a(this).data("ThinkBox");return this.each(function(){var d=a(this);switch(b){case"show":var e=d.data("ThinkBox");e&&e.show();break;case"hide":var e=d.data("ThinkBox");e&&e.hide();break;case"toggle":var e=d.data("ThinkBox");e&&e.toggle();break;default:var f={fixed:false,center:false,modal:false,drag:false},g=d.offset();b=a.isPlainObject(b)?b:{};a.extend(f,{dataEle:this,x:g.left,y:g.top+d.outerHeight()},b);if(f.event){var h=f.event;delete f.event;if(h=="hover"){d.hover(function(){c.call(d,f)},function(){d.ThinkBox("hide")})}else{d.bind(h,function(){c.call(d,f);return false})}}else{c.call(d,f)}}})}})(jQuery);