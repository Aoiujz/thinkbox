/**
 +-------------------------------------------------------------------
 * jQuery ThinkBox - 弹出层插件 - http://zjzit.cn/thinkbox
 +-------------------------------------------------------------------
 * @version    1.0.0beta
 * @since      2013.02.05
 * @author     麦当苗儿 <zuojiazi.cn@gmail.com>
 * @github     https://github.com/Aoiujz/ThinkBox.git
 +-------------------------------------------------------------------
 */
(function(e){function c(){this.css({zIndex:r++})}function h(){return{width:f.width(),height:f.height(),left:f.scrollLeft(),top:f.scrollTop()}}function p(t){e.isFunction(t)&&t.call(this)}function d(t,n){e.each(t,function(){if(this in n)delete n[this]})}var t,n={title:null,fixed:true,center:true,clone:true,x:0,y:0,modal:true,modalClose:true,resize:true,unload:false,close:"[关闭]",escHide:true,delayClose:0,drag:false,display:true,width:"",height:"",dataEle:"",locate:["left","top"],show:["fadeIn","normal"],hide:["fadeOut","normal"],button:[],style:"default",titleChange:undefined,beforeShow:undefined,afterShow:undefined,afterHide:undefined,beforeUnload:undefined,afterDrag:undefined},r=2013,i=null,s=['<div class="ThinkBox-wrapper" style="position:absolute;width: auto">','<table cellspacing="0" cellpadding="0" border="0" style="width: auto">',"<tr>",'<td class="box-top-left"></td>','<td class="box-top"></td>','<td class="box-top-right"></td>',"</tr>","<tr>",'<td class="box-left"></td>','<td class="ThinkBox-inner"></td>','<td class="box-right"></td>',"</tr>","<tr>",'<td class="box-bottom-left"></td>','<td class="box-bottom"></td>','<td class="box-bottom-right"></td>',"</tr>","</table>","</div>"].join(""),o=['<tr class="ThinkBox-title">','<td class="box-title-left"></td>','<td class="ThinkBox-title-inner"></td>','<td class="box-title-right"></td>',"</tr>"].join(""),u=['<tr class="ThinkBox-tools">','<td class="box-tools-left"></td>','<td class="ThinkBox-tools-inner"></td>','<td class="box-tools-right"></td>',"</tr>"].join(""),a=e(document),f=e(window),l=/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];t=function(t,d){function b(){function t(){d.delayClose&&e.isNumeric(d.delayClose)&&setTimeout(w,d.delayClose);p.call(v,d.afterShow)}if(m)return v;d.modal&&N();p.call(v,d.beforeShow);switch(d.show[0]){case"slideDown":y.stop(true,true).slideDown(d.show[1],t);break;case"fadeIn":y.stop(true,true).fadeIn(d.show[1],t);break;default:y.show(d.show[1],t)}m=true;D();return v}function w(){function t(){m=false;p.call(v,d.afterHide);d.unload&&_()}if(!m)return v;g&&g.fadeOut("normal",function(){e(this).remove();g=null});switch(d.hide[0]){case"slideUp":y.stop(true,true).slideUp(d.hide[1],t);break;case"fadeOut":y.stop(true,true).fadeOut(d.hide[1],t);break;default:y.hide(d.hide[1],t)}return v}function E(){var t=e(o),n=e(".ThinkBox-title-inner",t);if(d.drag){n.addClass("ThinkBox-draging");n[0].onselectstart=function(){return false};n[0].unselectable="on";n[0].style.MozUserSelect="none";L(n)}e("tr",y).first().after(t);S(d.title)}function S(t){var n=e(".ThinkBox-title-inner",y).empty();if(e.isArray(t)||e.isPlainObject(t)){for(key in t){e("<span>"+t[key]+"</span>").data("key",key).click(function(t){var r=e(this);if(!r.hasClass("selected")){n.find("span.selected").removeClass("selected");r.addClass("selected");p.call(r,d.titleChange)}}).mousedown(function(e){e.stopPropagation()}).mouseup(function(e){e.stopPropagation()}).appendTo(n)}}else{n.append("<span>"+t+"</span>")}}function x(){var t=e(u),n=e(".ThinkBox-tools-inner",t),r=null;for(key in d.button){r=e("<span/>").addClass("ThinkBox-button "+d.button[key][0]).html(d.button[key][1]).click(function(){p.call(v,d.button[key][2])}).hover(function(){e(this).addClass("hover")},function(){e(this).removeClass("hover")}).appendTo(n)}e("tr",y).last().before(t)}function T(){e("<span/>").addClass("ThinkBox-close").html(d.close).click(function(e){v.hide();e.stopPropagation()}).mousedown(function(e){e.stopPropagation()}).appendTo(e(".ThinkBox-inner",y))}function N(){if(l[0]){a.width=function(){return document.documentElement.scrollWidth};a.height=function(){return document.documentElement.scrollHeight}}g=e('<div class="ThinkBox-modal-blackout"></div>').addClass("ThinkBox-modal-blackout-"+d.style).css({zIndex:r++,width:a.width(),height:a.height(),position:"absolute",left:0,top:0}).click(function(e){d.modalClose&&i&&i.hide();e.stopPropagation()}).mousedown(function(e){e.stopPropagation()}).appendTo(e("body"));f.resize(function(){g&&g.css({width:"",height:""}).css({width:a.width(),height:a.height()})})}function C(t){var t=e("<div/>").addClass("ThinkBox-content").append((d.clone?e(t).clone(true,true):e(t)).show());e(".ThinkBox-content",y).remove();e(".ThinkBox-inner",y).css({width:d.width,height:d.height}).append(t)}function k(){d.center?A():O(e.isNumeric(d.x)?d.x:e.isFunction(d.x)?d.x.call(e(d.dataEle)):0,e.isNumeric(d.y)?d.y:e.isFunction(d.y)?d.y.call(e(d.dataEle)):0)}function L(e){var t=null;a.mousemove(function(e){t&&y.css({left:e.pageX-t[0],top:e.pageY-t[1]})});e.mousedown(function(e){var n=y.offset();if(d.fixed){n.left-=f.scrollLeft();n.top-=f.scrollTop()}t=[e.pageX-n.left,e.pageY-n.top]}).mouseup(function(){t=null;p.call(v,d.afterDrag)})}function A(){var e=M(),t=h(),n=y.css("position")=="fixed"?[0,0]:[t.left,t.top],r=n[0]+t.width/2,i=n[1]+t.height/2;O(r-e[0]/2,i-e[1]/2)}function O(t,n){e.isNumeric(t)&&(d.locate[0]=="left"?y.css({left:t}):y.css({right:t}));e.isNumeric(n)&&(d.locate[1]=="top"?y.css({top:n}):y.css({bottom:n}))}function M(){var e=[0,0];if(m)e=[y.width(),y.height()];else{y.css({visibility:"hidden",display:"block"});var e=[y.width(),y.height()];y.css("display","none").css("visibility","visible")}return e}function _(){p.call(v,d.beforeUnload);y.remove();d.dataEle&&e(d.dataEle).removeData("ThinkBox")}function D(){i=v;c.call(y)}var v=this,m=false,g=null,d,y;d=e.extend({},n,d||{});y=e(s).addClass("ThinkBox-"+d.style).data("ThinkBox",this);d.dataEle&&e(d.dataEle).data("ThinkBox",this);y.hover(function(){p.call(v,d.mouseover)},function(){p.call(v,d.mouseout)}).mousedown(function(e){D();e.stopPropagation()}).click(function(e){e.stopPropagation()});C(t||"<div></div>");d.title!==null&&E();d.button.length&&x();d.close&&T();y.css("display","none").appendTo("body");y.find(".box-left").append(e("<div/>").css("width",y.find(".box-left").width()));this.hide=w;this.show=b;this.toggle=function(){m?v.hide():v.show()};this.getContent=function(){return e(".ThinkBox-content",y)};this.setContent=function(e){C(e);k();return v};this.setTitle=S;this.getSize=M;this.setSize=function(t,n){e(".ThinkBox-inner",y).css({width:t,height:n})};d.fixed&&(l[0]&&l[1]<7?d.fixed=false:y.css("position","fixed"));k();d.resize&&f.resize(function(){k()});v.escHide=d.escHide;d.display&&b();};a.mousedown(function(){i=null}).keypress(function(e){i&&i.escHide&&e.keyCode==27&&i.hide()});e.ThinkBox=function(n,r){if(e.isPlainObject(r)&&r.dataEle){var i=e(r.dataEle).data("ThinkBox");if(i)return r.display===false?i:i.show()}return new t(n,r)};e.extend(e.ThinkBox,{load:function(t,n){var r={clone:false,loading:"加载中...",type:"GET",dataType:"text",cache:false,parseData:undefined,onload:undefined},i,s,o,u,a,t=t.split(/\s+/);e.extend(r,n||{});o=r.parseData;u=r.onload;a=r.loading;s={data:r.data,type:r.type,dataType:r.dataType,cache:r.cache,success:function(n){t[1]&&(n=e(n).find(t[1]));e.isFunction(o)&&(n=o.call(r.dataEle,n));i.setContent(n);p.call(i,u);a||i.show()}};d(["data","type","cache","dataType","parseData","onload","loading"],r);i=a?e.ThinkBox('<div class="ThinkBox-load-loading">'+a+"</div>",r):e.ThinkBox("<div/>",e.extend({},r,{display:false}));e.ajax(t[0],s);return i},iframe:function(t,n){var r={width:500,height:400,scrolling:"no",onload:undefined},i,s,o;e.extend(r,n||{});o=r.onload;s=e("<iframe/>").attr({width:r.width,height:r.height,frameborder:0,scrolling:r.scrolling,src:t}).load(function(){p.call(i,o)});d(["width","height","scrolling","onload"],r);i=e.ThinkBox(s,r);return i},tips:function(t,n,r){var i={modalClose:false,escHide:false,unload:true,close:false,delayClose:1e3},s;switch(n){case 0:n="error";break;case 1:n="success";break}s='<div class="ThinkBox-tips ThinkBox-'+n+'">'+t+"</div>";e.extend(i,r||{});return e.ThinkBox(s,i)},success:function(e,t){return this.tips(e,"success",t)},error:function(e,t){return this.tips(e,"error",t)},loading:function(e,t){var n=t||{};n.delayClose=0;return this.tips(e,"loading",n)},msg:function(t,n){var r={drag:false,escHide:false,delayClose:0,center:false,title:"消息",x:0,y:0,locate:["right","bottom"],show:["slideDown","slow"],hide:["slideUp","slow"]},i;e.extend(r,n||{});i=e("<div/>").addClass("ThinkBox-msg").html(t);return e.ThinkBox(i,r)},alert:function(t,n){var r={title:"提示",modal:false,modalClose:false,unload:false},i=["ok","确定",undefined];e.extend(r,n||{});typeof r.okVal!="undefined"&&(i[1]=r.okVal);e.isFunction(r.ok)&&(i[2]=r.ok);d(["okVal","ok"],r);r.button=[i];var s=e("<div/>").addClass("ThinkBox-alert").html(t);return e.ThinkBox(s,r)},confirm:function(t,n){var r={title:"确认",modal:false,modalClose:false},i=[["ok","确定",undefined],["cancel","取消",undefined]];e.extend(r,n||{});typeof r.okVal!="undefined"&&(i[0][1]=r.okVal);typeof r.cancelVal!="undefined"&&(i[1][1]=r.cancelVal);e.isFunction(r.ok)&&(i[0][2]=r.ok);e.isFunction(r.cancel)&&(i[1][2]=r.cancel);d(["okVal","ok","cancelVal","cancel"],r);r.button=i;var s=e("<div/>").addClass("ThinkBox-confirm").html(t);return e.ThinkBox(s,r)},get:function(t){return e(t).closest(".ThinkBox-wrapper").data("ThinkBox")}});e.fn.ThinkBox=function(t){function n(t){var n=this.attr("think-href")||this.attr("href");if(n.substr(0,1)=="#"){e.ThinkBox(n,t)}else if(n.substr(0,7)=="http://"||n.substr(0,8)=="https://"){e.ThinkBox.iframe(n,t)}else{e.ThinkBox.load(n,t)}}if(t=="get")return e(this).data("ThinkBox");return this.each(function(){var r=e(this),i=r.data("ThinkBox"),s,o,u,a,f,l;switch(t){case"show":i&&i.show();break;case"hide":i&&i.hide();break;case"toggle":i&&i.toggle();break;default:s={title:r.attr("title"),dataEle:this,fixed:false,center:false,modal:false,drag:false};t=e.isPlainObject(t)?t:{};e.extend(s,{x:function(){return e(this).offset().left},y:function(){return e(this).offset().top+e(this).outerHeight()}},t);if(s.event){o=s.event;delete s.event;if(o=="hover"){u=s.boxOutClose||false;a=s.delayShow||0;f=null;l=null;d(["boxOutClose","delayShow"],s);s.mouseover=function(){if(l){clearTimeout(l);l=null}};s.mouseout=function(){this.hide()};r.hover(function(){f=f||setTimeout(function(){n.call(r,s)},a)},function(){if(f){clearTimeout(f);f=null}u?l=l||setTimeout(function(){l=null;r.ThinkBox("hide")},50):r.ThinkBox("hide")})}else{r.bind(o,function(){n.call(r,s);return false})}}else{n.call(r,s)}}})}})(jQuery)