/**
 +-------------------------------------------------------------------
 * jQuery ThinkBox - 弹出层插件 - http://zjzit.cn/thinkbox
 +-------------------------------------------------------------------
 * @version    1.0.0beta
 * @since      2012.06.26
 * @author     麦当苗儿 <zuojiazi.cn@vip.qq.com>
 * @github     https://github.com/Aoiujz/ThinkBox.git
 +-------------------------------------------------------------------
 */
(function(a){function i(b,c,d,e){var g=a(f);var b=a(".ThinkBox-title-inner",g).html("<span>"+b+"</span>");if(c){b.addClass("dragging");b[0].onselectstart=function(){return false};b[0].unselectable="on";b[0].style.MozUserSelect="none";n.call(this,b,d,e)}a("tr",this.box).first().after(g)}function j(b){var c=this;var d=a(g);var e=a(".ThinkBox-tools-inner",d);var f=null;a.each(b,function(b,d){f=a("<input/>").attr("type","button").addClass(d[0]).val(d[1]).click(function(){B.call(this,d[2],c)}).appendTo(e)});a("tr",this.box).last().before(d)}function k(b){var c=this;a('<a class="ThinkBox-close">'+b+"</a>").click(function(a){c.hide();a.stopPropagation()}).mousedown(function(a){a.stopPropagation()}).appendTo(a(".ThinkBox-inner",this.box))}function l(b,c,d){var e=this.box;b=a("<div/>").addClass("ThinkBox-content").append(a(b).clone(true,true).show());a(".ThinkBox-content",e).remove();a(".ThinkBox-inner",e).css({width:c,height:d}).append(b)}function m(b,c,d,e){var f=this.box;b?p.call(this,e):q.call(this,a.isNumeric(c)?c:a.isFunction(c)?c.call(f):0,a.isNumeric(d)?d:a.isFunction(d)?d.call(f):0,e)}function n(b,c,d){var e=null,f=this.box,g=this;a(document).mousemove(function(a){e&&f.css({left:a.pageX-e[0],top:a.pageY-e[1]})});b.mousedown(function(b){var d=f.offset();if(c){d.left-=a(window).scrollLeft();d.top-=a(window).scrollTop()}e=[b.pageX-d.left,b.pageY-d.top]}).mouseup(function(){e=null;B.call(g,d)})}function p(a){var b=this.box;s=r.call(this),v=A(),o=b.hasClass("fixed")?[0,0]:[v.left,v.top],x=o[0]+v.width/2,y=o[1]+v.height/2;q.call(this,x-s[0]/2,y-s[1]/2,a)}function q(b,c,d){var e=this.box;a.isNumeric(b)&&(d[0]=="left"?e.css({left:b}):e.css({right:b}));a.isNumeric(c)&&(d[1]=="top"?e.css({top:c}):e.css({bottom:c}))}function r(){var a=this.box;if(this.visible())return[a.width(),a.height()];else{a.css({visibility:"hidden",display:"block"});var b=[a.width(),a.height()];a.css("display","none").css("visibility","visible");return b}}function t(b,e){var f=a('<div class="ThinkBox-modal-blackout"></div>').addClass("ThinkBox-modal-blackout-"+b).css({zIndex:c++,width:a(document).width(),height:a(document).height()}).click(function(a){e&&d&&d.hide();a.stopPropagation()}).mousedown(function(a){a.stopPropagation()}).appendTo(a("body"));a(window).resize(function(){f.css({width:"",height:""});f.css({width:a(document).width(),height:a(document).height()})});return f}function u(){this.css({zIndex:c++})}function w(b,c){B.call(this,b);this.box.remove();c&&a(c).removeData("ThinkBox")}function z(){d=this;u.call(this.box)}function A(){var b=a(window);return a.extend({width:b.width(),height:b.height()},{left:b.scrollLeft(),top:b.scrollTop()})}function B(b,c){a.isFunction(b)&&b.call(this,c)}function C(b,c){a.each(b,function(){if(this in c)delete c[this]})}var b={title:null,fixed:true,center:true,x:0,y:0,modal:false,modalClose:true,resize:true,unload:false,close:"[关闭]",escHide:true,delayClose:0,drag:true,display:true,width:"",height:"",dataEle:"",locate:["left","top"],show:["fadeIn","normal"],hide:["fadeOut","normal"],style:"default",beforeShow:undefined,afterShow:undefined,afterHide:undefined,beforeUnload:undefined,afterDrag:undefined};var c=2012;var d=null;var e=['<div class="ThinkBox-wrapper">','<table cellspacing="0" cellpadding="0" border="0">',"<tr>",'<td class="box-top-left"></td>','<td class="box-top"></td>','<td class="box-top-right"></td>',"</tr>","<tr>",'<td class="box-left"></td>','<td class="ThinkBox-inner"></td>','<td class="box-right"></td>',"</tr>","<tr>",'<td class="box-bottom-left"></td>','<td class="box-bottom"></td>','<td class="box-bottom-right"></td>',"</tr>","</table>","</div>"].join("");var f=['<tr class="ThinkBox-title">','<td class="box-title-left"></td>','<td class="ThinkBox-title-inner"></td>','<td class="box-title-right"></td>',"</tr>"].join("");var g=['<tr class="ThinkBox-tools">','<td class="box-tools-left"></td>','<td class="ThinkBox-tools-inner"></td>','<td class="box-tools-right"></td>',"</tr>"].join("");var h=function(c,d){function p(){function b(){d.delayClose&&a.isNumeric(d.delayClose)&&setTimeout(q,d.delayClose);B.call(f,d.afterShow)}if(g)return this;d.modal&&(h=t.call(f,d.style,d.modalClose));B.call(f,d.beforeShow);switch(d.show[0]){case"slideDown":n.stop(true,true).slideDown(d.show[1],b);break;case"fadeIn":n.stop(true,true).fadeIn(d.show[1],b);break;default:n.show(d.show[1],b)}g=true;z.call(f);return this}function q(){function b(){g=false;B.call(f,d.afterHide);d.unload&&w.call(f,d.beforeUnload,d.dataEle)}if(!g)return;h&&h.fadeOut("normal",function(){a(this).remove();h=null});switch(d.hide[0]){case"slideUp":n.stop(true,true).slideUp(d.show[1],b);break;case"fadeOut":n.stop(true,true).fadeOut(d.show[1],b);break;default:n.hide(d.show[1],b)}}var f=this,g=false,h=null;var d=a.extend({},b,d||{});var n=a(e).addClass("ThinkBox-"+d.style).data("ThinkBox",this);d.dataEle&&a(d.dataEle).data("ThinkBox",this);n.hover(function(){B.call(f,d.mouseover)},function(){B.call(f,d.mouseout)}).mousedown(function(a){z.call(f);a.stopPropagation()}).click(function(a){a.stopPropagation()});this.box=n;this.visible=function(){return g};l.call(this,c||"<div></div>",d.width,d.height);d.title!==null&&i.call(this,d.title,d.drag,d.fixed,d.afterDrag);d.button&&j.call(this,d.button);d.close&&k.call(f,d.close);n.css("display","none").appendTo("body");var o=n.find(".box-left");o.append(a("<div></div>").css("width",o.width()));d.fixed&&(a.browser.msie&&a.browser.version<7?d.fixed=false:n.addClass("fixed"));m.call(this,d.center,d.x,d.y,d.locate);d.resize&&a(window).resize(function(){m.call(f,d.center,d.x,d.y,d.locate)});f.escHide=d.escHide;d.display&&p();this.hide=q;this.show=p;this.toggle=function(){g?f.hide():f.show()};this.getContent=function(){return a(".ThinkBox-content",n)};this.setContent=function(a){l.call(f,a,d.width,d.height);m.call(f,d.center,d.x,d.y,d.locate);return f};this.getSize=function(){return r.call(f)};this.setSize=function(b,c){a(".ThinkBox-inner",n).css({width:b,height:c})};};a(document).mousedown(function(){d=null}).keypress(function(a){d&&d.escHide&&a.keyCode==27&&d.hide()});a.ThinkBox=function(b,c){if(a.isPlainObject(c)&&c.dataEle){var d=a(c.dataEle).data("ThinkBox");if(d)return c.display===false?d:d.show()}return new h(b,c)};a.extend(a.ThinkBox,{load:function(b,c){var d={type:"GET",dataType:"text",cache:false,parseData:undefined};a.extend(d,c||{});var e=a.ThinkBox('<div class="ThinkBox-load-loading">加载中...</div>',d);if(!e.getContent().children().is(".ThinkBox-load-loading"))return e;var f={type:d.type,dataType:d.dataType,cache:d.cache,success:function(b){a.isFunction(d.parseData)&&(b=B.call(d.dataEle,d.parseData));C(["type","cache","dataType","parseData"],d);e.setContent(b)}};a.ajax(b,f);return e},iframe:function(b,c){var d={width:500,height:400,scrolling:"no"};a.extend(d,c||{});var e='<iframe src="'+b+'" width="'+d.width+'" height="'+d.height+'" frameborder="0" scrolling="'+d.scrolling+'"></iframe>';delete d.width,delete d.height,delete d.scrolling;return a.ThinkBox(e,d)},tips:function(b,c,d){switch(c){case 0:c="error";break;case 1:c="success";break}var e='<div class="ThinkBox-tips ThinkBox-'+c+'">'+b+"</div>";var f={modal:false,escHide:false,unload:true,close:false,delayClose:1e3};a.extend(f,d||{});return a.ThinkBox(e,f)},success:function(a,b){return this.tips(a,"success",b)},error:function(a,b){return this.tips(a,"error",b)},loading:function(b,c){var d={modal:true,modalClose:false,delayClose:0};a.extend(d,c||{});return this.tips(b,"loading",d)},msg:function(b,c){var d='<div class="ThinkBox-msg">'+b+"</div>";var e={drag:false,escHide:false,delayClose:0,center:false,title:"消息",x:0,y:0,locate:["right","bottom"],show:["slideDown","slow"],hide:["slideUp","slow"]};a.extend(e,c||{});return a.ThinkBox(d,e)},alert:function(b,c){var d={title:"提示",modal:false,modalClose:false,unload:false},e=["ok","确定",undefined];a.extend(d,c||{});typeof d.okValue!="undefined"&&(e[1]=d.okValue);a.isFunction(d.okClick)&&(e[2]=d.okClick);C(["okValue","okClick"],d);d.button=[e];var f=a("<div/>").addClass("alert").html(b);return a.ThinkBox(f,d)},confirm:function(b,c){var d={title:"确认",modal:false,modalClose:false},e=[["ok","确定",undefined],["cancel","取消",undefined]];a.extend(d,c||{});typeof d.okValue!="undefined"&&(e[0][1]=d.okValue);typeof d.cancelValue!="undefined"&&(e[1][1]=d.cancelValue);a.isFunction(d.okClick)&&(e[0][2]=d.okClick);a.isFunction(d.cancelClick)&&(e[1][2]=d.cancelClick);C(["okValue","okClick","cancelValue","cancelClick"],d);d.button=e;var f=a("<div/>").addClass("confirm").html(b);return a.ThinkBox(f,d)},get:function(b){return a(b).parents(".ThinkBox-wrapper").data("ThinkBox")}});a.fn.ThinkBox=function(b){function c(b){var c=this.attr("think-href")||this.attr("href");if(c.substr(0,1)=="#"){a.ThinkBox(c,b)}else if(c.substr(0,7)=="http://"||c.substr(0,8)=="https://"){a.ThinkBox.iframe(c,b)}else{a.ThinkBox.load(c,b)}}if(b=="get")return a(this).data("ThinkBox");return this.each(function(){var d=a(this);switch(b){case"show":var e=d.data("ThinkBox");e&&e.show();break;case"hide":var e=d.data("ThinkBox");e&&e.hide();break;case"toggle":var e=d.data("ThinkBox");e&&e.toggle();break;default:var f={dataEle:this,fixed:false,center:false,modal:false,drag:false};b=a.isPlainObject(b)?b:{};a.extend(f,{x:function(){return d.offset().left},y:function(){return d.offset().top+d.outerHeight()}},b);if(f.event){var g=f.event;delete f.event;if(g=="hover"){var h=f.boxoutClose||false,i=f.delayShow||0,j=null,k=null;C(["boxoutClose","delayShow"],f);f.mouseover=function(){if(k){clearTimeout(k);k=null}};f.mouseout=function(){this.hide()};d.hover(function(){j=j||setTimeout(function(){c.call(d,f)},i)},function(){if(j){clearTimeout(j);j=null}h?k=k||setTimeout(function(){k=null;d.ThinkBox("hide")},50):d.ThinkBox("hide")})}else{d.bind(g,function(){c.call(d,f);return false})}}else{c.call(d,f)}}})}})(jQuery)