/**
 +-------------------------------------------------------------------
 * jQuery ThinkBox - 弹出层插件 - http://zjzit.cn/thinkbox
 +-------------------------------------------------------------------
 * @version    1.0.0beta
 * @since      2012.09.13
 * @author     麦当苗儿 <zuojiazi.cn@gmail.com>
 * @github     https://github.com/Aoiujz/ThinkBox.git
 +-------------------------------------------------------------------
 */
(function(a){function i(){this.css({zIndex:c++})}function j(){var b=a(window);return a.extend({width:b.width(),height:b.height()},{left:b.scrollLeft(),top:b.scrollTop()})}function k(b){a.isFunction(b)&&b.call(this)}function l(b,c){a.each(b,function(){if(this in c)delete c[this]})}var b={title:null,fixed:true,center:true,clone:true,x:0,y:0,modal:false,modalClose:true,resize:true,unload:false,close:"[关闭]",escHide:true,delayClose:0,drag:true,display:true,width:"",height:"",dataEle:"",locate:["left","top"],show:["fadeIn","normal"],hide:["fadeOut","normal"],button:[],style:"default",titleChange:undefined,beforeShow:undefined,afterShow:undefined,afterHide:undefined,beforeUnload:undefined,afterDrag:undefined};var c=2012;var d=null;var e=['<div class="ThinkBox-wrapper">','<table cellspacing="0" cellpadding="0" border="0">',"<tr>",'<td class="box-top-left"></td>','<td class="box-top"></td>','<td class="box-top-right"></td>',"</tr>","<tr>",'<td class="box-left"></td>','<td class="ThinkBox-inner"></td>','<td class="box-right"></td>',"</tr>","<tr>",'<td class="box-bottom-left"></td>','<td class="box-bottom"></td>','<td class="box-bottom-right"></td>',"</tr>","</table>","</div>"].join("");var f=['<tr class="ThinkBox-title">','<td class="box-title-left"></td>','<td class="ThinkBox-title-inner"></td>','<td class="box-title-right"></td>',"</tr>"].join("");var g=['<tr class="ThinkBox-tools">','<td class="box-tools-left"></td>','<td class="ThinkBox-tools-inner"></td>','<td class="box-tools-right"></td>',"</tr>"].join("");var h=function(h,l){function r(){function b(){l.delayClose&&a.isNumeric(l.delayClose)&&setTimeout(s,l.delayClose);k.call(m,l.afterShow)}if(n)return m;l.modal&&x();k.call(m,l.beforeShow);switch(l.show[0]){case"slideDown":p.stop(true,true).slideDown(l.show[1],b);break;case"fadeIn":p.stop(true,true).fadeIn(l.show[1],b);break;default:p.show(l.show[1],b)}n=true;F();return m}function s(){function b(){n=false;k.call(m,l.afterHide);l.unload&&E()}if(!n)return m;o&&o.fadeOut("normal",function(){a(this).remove();o=null});switch(l.hide[0]){case"slideUp":p.stop(true,true).slideUp(l.show[1],b);break;case"fadeOut":p.stop(true,true).fadeOut(l.show[1],b);break;default:p.hide(l.show[1],b)}return m}function t(){var b=a(f);var c=a(".ThinkBox-title-inner",b);if(l.drag){c.addClass("dragging");c[0].onselectstart=function(){return false};c[0].unselectable="on";c[0].style.MozUserSelect="none";A(c)}a("tr",p).first().after(b);u(l.title)}function u(b){var c=a(".ThinkBox-title-inner",p).empty();if(a.isArray(b)||a.isPlainObject(b)){a.each(b,function(b,d){a("<span>"+d+"</span>").data("key",b).click(function(b){var d=a(this);if(!d.hasClass("selected")){c.find("span.selected").removeClass("selected");d.addClass("selected");k.call(d,l.titleChange)}}).mousedown(function(a){a.stopPropagation()}).mouseup(function(a){a.stopPropagation()}).appendTo(c)})}else{c.append("<span>"+b+"</span>")}}function v(){var b=a(g);var c=a(".ThinkBox-tools-inner",b);var d=null;a.each(l.button,function(b,e){d=a("<input/>").attr("type","button").addClass(e[0]).val(e[1]).click(function(){k.call(m,e[2])}).appendTo(c)});a("tr",p).last().before(b)}function w(){a('<a class="ThinkBox-close">'+l.close+"</a>").click(function(a){m.hide();a.stopPropagation()}).mousedown(function(a){a.stopPropagation()}).appendTo(a(".ThinkBox-inner",p))}function x(){var b=a(document);o=a('<div class="ThinkBox-modal-blackout"></div>').addClass("ThinkBox-modal-blackout-"+l.style).css({zIndex:c++,width:b.width(),height:b.height()}).click(function(a){l.modalClose&&d&&d.hide();a.stopPropagation()}).mousedown(function(a){a.stopPropagation()}).appendTo(a("body"));a(window).resize(function(){o&&o.css({width:"",height:""}).css({width:b.width(),height:b.height()})})}function y(b){var b=a("<div/>").addClass("ThinkBox-content").append(l.clone?a(b).clone(true,true).show():a(b));a(".ThinkBox-content",p).remove();a(".ThinkBox-inner",p).css({width:l.width,height:l.height}).append(b)}function z(){l.center?B():C(a.isNumeric(l.x)?l.x:a.isFunction(l.x)?l.x.call(l.dataEle):0,a.isNumeric(l.y)?l.y:a.isFunction(l.y)?l.y.call(l.dataEle):0)}function A(b){var c=null;a(document).mousemove(function(a){c&&p.css({left:a.pageX-c[0],top:a.pageY-c[1]})});b.mousedown(function(b){var d=p.offset();if(l.fixed){d.left-=a(window).scrollLeft();d.top-=a(window).scrollTop()}c=[b.pageX-d.left,b.pageY-d.top]}).mouseup(function(){c=null;k.call(m,l.afterDrag)})}function B(){var a=D(),b=j(),c=p.hasClass("fixed")?[0,0]:[b.left,b.top],d=c[0]+b.width/2,e=c[1]+b.height/2;C(d-a[0]/2,e-a[1]/2)}function C(b,c){a.isNumeric(b)&&(l.locate[0]=="left"?p.css({left:b}):p.css({right:b}));a.isNumeric(c)&&(l.locate[1]=="top"?p.css({top:c}):p.css({bottom:c}))}function D(){if(n)return[p.width(),p.height()];else{p.css({visibility:"hidden",display:"block"});var a=[p.width(),p.height()];p.css("display","none").css("visibility","visible");return a}}function E(){k.call(m,l.beforeUnload);p.remove();l.dataEle&&a(l.dataEle).removeData("ThinkBox")}function F(){d=m;i.call(p)}var m=this,n=false,o=null;var l=a.extend({},b,l||{});var p=a(e).addClass("ThinkBox-"+l.style).data("ThinkBox",this);l.dataEle&&a(l.dataEle).data("ThinkBox",this);p.hover(function(){k.call(m,l.mouseover)},function(){k.call(m,l.mouseout)}).mousedown(function(a){F();a.stopPropagation()}).click(function(a){a.stopPropagation()});y(h||"<div></div>");l.title!==null&&t();l.button.length&&v();l.close&&w();p.css("display","none").appendTo("body");var q=p.find(".box-left");q.append(a("<div></div>").css("width",q.width()));this.hide=s;this.show=r;this.toggle=function(){n?m.hide():m.show()};this.getContent=function(){return a(".ThinkBox-content",p)};this.setContent=function(a){y(a);z();return m};this.setTitle=u;this.getSize=D;this.setSize=function(b,c){a(".ThinkBox-inner",p).css({width:b,height:c})};l.fixed&&(a.browser.msie&&a.browser.version<7?l.fixed=false:p.addClass("fixed"));z();l.resize&&a(window).resize(function(){z()});m.escHide=l.escHide;l.display&&r();};a(document).mousedown(function(){d=null}).keypress(function(a){d&&d.escHide&&a.keyCode==27&&d.hide()});a.ThinkBox=function(b,c){if(a.isPlainObject(c)&&c.dataEle){var d=a(c.dataEle).data("ThinkBox");if(d)return c.display===false?d:d.show()}return new h(b,c)};a.extend(a.ThinkBox,{load:function(b,c){var d={clone:false,loading:"加载中...",type:"GET",dataType:"text",cache:false,parseData:undefined,onload:undefined},e;a.extend(d,c||{});var f=d.parseData,g=d.onload,h=d.loading,b=b.split(/\s+/);var i={type:d.type,dataType:d.dataType,cache:d.cache,success:function(c){b[1]&&(c=a(c).find(b[1]));a.isFunction(f)&&(c=f.call(d.dataEle,c));e.setContent(c);k.call(e,g);h||e.show()}};l(["type","cache","dataType","parseData","onload","loading"],d);e=h?a.ThinkBox('<div class="ThinkBox-load-loading">'+h+"</div>",d):a.ThinkBox("<div/>",a.extend({},d,{display:false}));if(!e.getContent().children().is(".ThinkBox-load-loading"))return e;a.ajax(b[0],i);return e},iframe:function(b,c){var d={width:500,height:400,scrolling:"no",onload:undefined},e;a.extend(d,c||{});var f=d.onload;var g=a("<iframe/>").attr({width:d.width,height:d.height,frameborder:0,scrolling:d.scrolling,src:b}).load(function(){k.call(e,f)});l(["width","height","scrolling","onload"],d);e=a.ThinkBox(g,d);return e},tips:function(b,c,d){switch(c){case 0:c="error";break;case 1:c="success";break}var e='<div class="ThinkBox-tips ThinkBox-'+c+'">'+b+"</div>";var f={modal:false,escHide:false,unload:true,close:false,delayClose:1e3};a.extend(f,d||{});return a.ThinkBox(e,f)},success:function(a,b){return this.tips(a,"success",b)},error:function(a,b){return this.tips(a,"error",b)},loading:function(b,c){var d={modal:true,modalClose:false,delayClose:0};a.extend(d,c||{});return this.tips(b,"loading",d)},msg:function(b,c){var d='<div class="ThinkBox-msg">'+b+"</div>";var e={drag:false,escHide:false,delayClose:0,center:false,title:"消息",x:0,y:0,locate:["right","bottom"],show:["slideDown","slow"],hide:["slideUp","slow"]};a.extend(e,c||{});return a.ThinkBox(d,e)},alert:function(b,c){var d={title:"提示",modal:false,modalClose:false,unload:false},e=["ok","确定",undefined];a.extend(d,c||{});typeof d.okValue!="undefined"&&(e[1]=d.okValue);a.isFunction(d.okClick)&&(e[2]=d.okClick);l(["okValue","okClick"],d);d.button=[e];var f=a("<div/>").addClass("alert").html(b);return a.ThinkBox(f,d)},confirm:function(b,c){var d={title:"确认",modal:false,modalClose:false},e=[["ok","确定",undefined],["cancel","取消",undefined]];a.extend(d,c||{});typeof d.okValue!="undefined"&&(e[0][1]=d.okValue);typeof d.cancelValue!="undefined"&&(e[1][1]=d.cancelValue);a.isFunction(d.okClick)&&(e[0][2]=d.okClick);a.isFunction(d.cancelClick)&&(e[1][2]=d.cancelClick);l(["okValue","okClick","cancelValue","cancelClick"],d);d.button=e;var f=a("<div/>").addClass("confirm").html(b);return a.ThinkBox(f,d)},get:function(b){return a(b).closest(".ThinkBox-wrapper").data("ThinkBox")}});a.fn.ThinkBox=function(b){function c(b){var c=this.attr("think-href")||this.attr("href");if(c.substr(0,1)=="#"){a.ThinkBox(c,b)}else if(c.substr(0,7)=="http://"||c.substr(0,8)=="https://"){a.ThinkBox.iframe(c,b)}else{a.ThinkBox.load(c,b)}}if(b=="get")return a(this).data("ThinkBox");return this.each(function(){var d=a(this);var e=d.data("ThinkBox");switch(b){case"show":e&&e.show();break;case"hide":e&&e.hide();break;case"toggle":e&&e.toggle();break;default:var f={dataEle:this,fixed:false,center:false,modal:false,drag:false};b=a.isPlainObject(b)?b:{};a.extend(f,{x:function(){return a(this).offset().left},y:function(){return a(this).offset().top+a(this).outerHeight()}},b);if(f.event){var g=f.event;delete f.event;if(g=="hover"){var h=f.boxOutClose||false,i=f.delayShow||0,j=null,k=null;l(["boxOutClose","delayShow"],f);f.mouseover=function(){if(k){clearTimeout(k);k=null}};f.mouseout=function(){this.hide()};d.hover(function(){j=j||setTimeout(function(){c.call(d,f)},i)},function(){if(j){clearTimeout(j);j=null}h?k=k||setTimeout(function(){k=null;d.ThinkBox("hide")},50):d.ThinkBox("hide")})}else{d.bind(g,function(){c.call(d,f);return false})}}else{c.call(d,f)}}})}})(jQuery)