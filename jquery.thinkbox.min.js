/**
 +-------------------------------------------------------------------
 * jQuery ThinkBox - 弹出层插件 - http://zjzit.cn/thinkbox
 +-------------------------------------------------------------------
 * @version    1.0.0beta
 * @since      2013.02.05
 * @author     麦当苗儿 <zuojiazi.cn@gmail.com>
 * @github     https://github.com/Aoiujz/ThinkBox.git
 +-------------------------------------------------------------------
 */
(function(e){function l(){this.css({zIndex:i++})}function c(){return{width:a.width(),height:a.height(),left:a.scrollLeft(),top:a.scrollTop()}}function h(t){e.isFunction(t)&&t.call(this)}function p(t,n){e.each(t,function(){if(this in n)delete n[this]})}function d(e){e.onselectstart=function(){return false};e.unselectable="on";e.style.MozUserSelect="none";e.style.WebkitUserSelect="none"}function v(e){e.onselectstart=function(){return true};e.unselectable="off";e.style.MozUserSelect="auto";e.style.WebkitUserSelect="auto"}function m(n,r){var i=t.slice(0,t.lastIndexOf("/"));if(e("link[href='"+i+n+"']").length){h(r);return}e("<link/>").load(function(){h(r)}).attr({href:i+n,type:"text/css",rel:"stylesheet"}).appendTo("head")}var t=e("script").last().attr("src"),n,r={title:null,fixed:true,center:true,clone:true,x:0,y:0,modal:true,modalClose:true,resize:true,unload:false,close:"×",escHide:true,delayClose:0,drag:false,display:true,width:"",height:"",dataEle:"",locate:["left","top"],show:["fadeIn","normal"],hide:["fadeOut","normal"],button:false,style:"default",titleChange:undefined,beforeShow:undefined,afterShow:undefined,afterHide:undefined,beforeUnload:undefined,afterDrag:undefined},i=2013,s=null,o=['<div class="thinkbox" style="position:absolute;width: auto">','<table cellspacing="0" cellpadding="0" border="0" style="width: auto">',"<tr>",'<td class="thinkbox-top-left"></td>','<td class="thinkbox-top"></td>','<td class="thinkbox-top-right"></td>',"</tr>","<tr>",'<td class="thinkbox-left"></td>',"<td>",'<div class="thinkbox-head"></div>','<div class="thinkbox-body"></div>','<div class="thinkbox-foot"></div>',"</td>",'<td class="thinkbox-right"></td>',"</tr>","<tr>",'<td class="thinkbox-bottom-left"></td>','<td class="thinkbox-bottom"></td>','<td class="thinkbox-bottom-right"></td>',"</tr>","</table>","</div>"].join(""),u=e(document),a=e(window),f=/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];n=function(t,n){function w(){function t(){n.delayClose&&e.isNumeric(n.delayClose)&&setTimeout(E,n.delayClose);h.call(p,n.afterShow)}if(g)return p;n.modal&&C();h.call(p,n.beforeShow);switch(n.show[0]){case"slideDown":b.stop(true,true).slideDown(n.show[1],t);break;case"fadeIn":b.stop(true,true).fadeIn(n.show[1],t);break;default:b.show(n.show[1],t)}g=true;P();return p}function E(){function t(){g=false;h.call(p,n.afterHide);n.unload&&D()}if(!g)return p;y&&y.fadeOut("normal",function(){e(this).remove();y=null});switch(n.hide[0]){case"slideUp":b.stop(true,true).slideUp(n.hide[1],t);break;case"fadeOut":b.stop(true,true).fadeOut(n.hide[1],t);break;default:b.hide(n.hide[1],t)}return p}function S(){var t=e('<div class="thinkbox-title"></div>');if(n.drag){t.addClass("thinkbox-draging");A(t)}e(".thinkbox-head",b).append(t);x(n.title)}function x(t){var n=e(".thinkbox-title",b).empty();n.append("<span>"+t+"</span>")}function T(){function r(n,r,i){var s=e('<span class="thinkbox-button thinkbox-button-'+n+'"></span>').html(r).click(function(){i()}).appendTo(t)}var t=e('<div class="thinkbox-tools"></div>');for(key in n.button){switch(key){case"ok":r(key,n.button[key],function(){p.hide()});break;case"submit":r(key,n.button[key],function(){b.find("form").submit()});break;default:r("cancel",n.button[key],function(){p.hide()})}}e(".thinkbox-foot",b).append(t)}function N(){e("<div/>").addClass("thinkbox-close").html(n.close).click(function(e){p.hide();e.stopPropagation()}).mousedown(function(e){e.stopPropagation()}).appendTo(e(".thinkbox-head",b))}function C(){if(f[0]){u.width=function(){return document.documentElement.scrollWidth};u.height=function(){return document.documentElement.scrollHeight}}y=e('<div class="thinkbox-modal-blackout-'+n.style+'"></div>').css({zIndex:i++,width:u.width(),height:u.height(),position:"absolute",left:0,top:0}).click(function(e){n.modalClose&&s&&s.hide();e.stopPropagation()}).mousedown(function(e){e.stopPropagation()}).appendTo(e("body"));a.resize(function(){y&&y.css({width:"",height:""}).css({width:u.width(),height:u.height()})})}function k(t){var t=(n.clone?e(t).clone(true,true):e(t)).show();e(".thinkbox-body",b).empty().css({width:n.width,height:n.height}).append(t)}function L(){n.center?O():M(e.isNumeric(n.x)?n.x:e.isFunction(n.x)?n.x.call(e(n.dataEle)):0,e.isNumeric(n.y)?n.y:e.isFunction(n.y)?n.y.call(e(n.dataEle)):0)}function A(e){var t=null;u.mousemove(function(e){t&&b.css({left:e.pageX-t[0],top:e.pageY-t[1]})});e.mousedown(function(e){var r=b.offset();if(n.fixed){r.left-=a.scrollLeft();r.top-=a.scrollTop()}d(b[0]);t=[e.pageX-r.left,e.pageY-r.top]}).mouseup(function(){t=null;v(b[0]);h.call(p,n.afterDrag)})}function O(){var e=_(),t=c(),n=b.css("position")=="fixed"?[0,0]:[t.left,t.top],r=n[0]+t.width/2,i=n[1]+t.height/2;M(r-e[0]/2,i-e[1]/2)}function M(t,r){e.isNumeric(t)&&(n.locate[0]=="left"?b.css({left:t}):b.css({right:t}));e.isNumeric(r)&&(n.locate[1]=="top"?b.css({top:r}):b.css({bottom:r}))}function _(){var e=[0,0];if(g)e=[b.width(),b.height()];else{b.css({visibility:"hidden",display:"block"});var e=[b.width(),b.height()];b.css("display","none").css("visibility","visible")}return e}function D(){h.call(p,n.beforeUnload);b.remove();n.dataEle&&e(n.dataEle).removeData("thinkbox")}function P(){s=p;l.call(b)}var p=this,g=false,y=null,n,b;n=e.extend({},r,n||{});m("/skin/"+n.style+"/style.css",function(){b=e(o).addClass("thinkbox-"+n.style).data("thinkbox",p);n.dataEle&&e(n.dataEle).data("thinkbox",p);b.hover(function(){h.call(p,n.mouseover)},function(){h.call(p,n.mouseout)}).mousedown(function(e){P();e.stopPropagation()}).click(function(e){e.stopPropagation()});k(t||"<div></div>");n.title!==null&&S();n.button&&T();n.close&&N();b.css("display","none").appendTo("body");e(".thinkbox-left",b).append(e("<div/>").css("width",e(".thinkbox-left",b).width()));p.hide=E;p.show=w;p.toggle=function(){g?p.hide():p.show()};p.getContent=function(){return e(".thinkbox-body",b).html()};p.setContent=function(e){k(e);L();return p};p.setTitle=x;p.getSize=_;p.setSize=function(t,n){e(".thinkbox-body",b).css({width:t,height:n})};n.fixed&&(f[0]&&f[1]<7?n.fixed=false:b.css("position","fixed"));L();n.resize&&a.resize(function(){L()});p.escHide=n.escHide;n.display&&w()});};u.mousedown(function(){s=null}).keypress(function(e){s&&s.escHide&&e.keyCode==27&&s.hide()});e.thinkbox=function(t,r){if(e.isPlainObject(r)&&r.dataEle){var i=e(r.dataEle).data("thinkbox");if(i)return r.display===false?i:i.show()}return new n(t,r)};e.extend(e.thinkbox,{load:function(t,n){var r={clone:false,loading:"加载中...",type:"GET",dataType:"text",cache:false,parseData:undefined,onload:undefined},i,s,o,u,a,t=t.split(/\s+/);e.extend(r,n||{});o=r.parseData;u=r.onload;a=r.loading;s={data:r.data,type:r.type,dataType:r.dataType,cache:r.cache,success:function(n){t[1]&&(n=e(n).find(t[1]));e.isFunction(o)&&(n=o.call(r.dataEle,n));i.setContent(n);h.call(i,u);a||i.show()}};p(["data","type","cache","dataType","parseData","onload","loading"],r);i=a?e.thinkbox('<div class="thinkbox-load-loading">'+a+"</div>",r):e.thinkbox("<div/>",e.extend({},r,{display:false}));e.ajax(t[0],s);return i},iframe:function(t,n){var r={width:500,height:400,scrolling:"no",onload:undefined},i,s,o;e.extend(r,n||{});o=r.onload;s=e("<iframe/>").attr({width:r.width,height:r.height,frameborder:0,scrolling:r.scrolling,src:t}).load(function(){h.call(i,o)});p(["width","height","scrolling","onload"],r);i=e.thinkbox(s,r);return i},tips:function(t,n,r){var i={modalClose:false,escHide:false,unload:true,close:false,delayClose:1e3},s;switch(n){case 0:n="error";break;case 1:n="success";break}s='<div class="thinkbox-tips thinkbox-tips-'+n+'">'+t+"</div>";e.extend(i,r||{});return e.thinkbox(s,i)},success:function(e,t){return this.tips(e,"success",t)},error:function(e,t){return this.tips(e,"error",t)},loading:function(e,t){var n=t||{};n.delayClose=0;return this.tips(e,"loading",n)},msg:function(t,n){var r={drag:false,escHide:false,delayClose:0,center:false,title:"消息",x:0,y:0,locate:["right","bottom"],show:["slideDown","slow"],hide:["slideUp","slow"]},i;e.extend(r,n||{});i=e("<div/>").addClass("thinkbox-msg").html(t);return e.thinkbox(i,r)},alert:function(t,n){var r={title:"提示",modal:false,modalClose:false,unload:false},i={ok:"确定"};e.extend(r,n||{});r.ok&&i.ok=r.ok;p(["ok"],r);r.button=i;var s=e("<div/>").addClass("thinkbox-alert").html(t);return e.thinkbox(s,r)},confirm:function(t,n){var r={title:"确认",modal:false,modalClose:false},i={ok:"确定",cancel:"取消"};e.extend(r,n||{});r.ok&&i.ok=r.ok;r.cancel&&i.cancel=r.cancel;p(["ok","cancel"],r);r.button=i;var s=e("<div/>").addClass("thinkbox-confirm").html(t);return e.thinkbox(s,r)},get:function(t){return e(t).closest(".thinkbox").data("thinkbox")}});e.fn.thinkbox=function(t){function n(t){var n=this.data("href")||this.attr("href");if(n.substr(0,1)=="#"){e.thinkbox(n,t)}else if(n.substr(0,7)=="http://"||n.substr(0,8)=="https://"){e.thinkbox.iframe(n,t)}else{e.thinkbox.load(n,t)}}if(t=="get")return e(this).data("thinkbox");return this.each(function(){var r=e(this),i=r.data("thinkbox"),s,o,u,a,f,l;switch(t){case"show":i&&i.show();break;case"hide":i&&i.hide();break;case"toggle":i&&i.toggle();break;default:s={title:r.attr("title"),dataEle:this,fixed:false,center:false,modal:false,drag:false};t=e.isPlainObject(t)?t:{};e.extend(s,{x:function(){return e(this).offset().left},y:function(){return e(this).offset().top+e(this).outerHeight()}},t);if(s.event){o=s.event;delete s.event;if(o=="hover"){u=s.boxOutClose||false;a=s.delayShow||0;f=null;l=null;p(["boxOutClose","delayShow"],s);s.mouseover=function(){if(l){clearTimeout(l);l=null}};s.mouseout=function(){this.hide()};r.hover(function(){f=f||setTimeout(function(){n.call(r,s)},a)},function(){if(f){clearTimeout(f);f=null}u?l=l||setTimeout(function(){l=null;r.thinkbox("hide")},50):r.thinkbox("hide")})}else{r.bind(o,function(){n.call(r,s);return false})}}else{n.call(r,s)}}})}})(jQuery)