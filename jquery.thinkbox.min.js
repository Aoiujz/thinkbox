/**
 +-------------------------------------------------------------------
 * jQuery ThinkBox - 弹出层插件 - http://zjzit.cn/thinkbox
 +-------------------------------------------------------------------
 * @version    1.0.0beta
 * @since      2013.02.05
 * @author     麦当苗儿 <zuojiazi.cn@gmail.com>
 * @github     https://github.com/Aoiujz/ThinkBox.git
 +-------------------------------------------------------------------
 */
(function(e){function h(){this.css({zIndex:i++})}function p(){return{width:l.width(),height:l.height(),left:l.scrollLeft(),top:l.scrollTop()}}function d(t){e.isFunction(t)&&t.call(this)}function v(t,n){e.each(t,function(){if(this in n)delete n[this]})}function m(n,r){var i=t.slice(0,t.lastIndexOf("/"));if(e("link[href='"+i+n+"']").length){d(r);return}e("<link/>").load(function(){d(r)}).attr({href:i+n,type:"text/css",rel:"stylesheet"}).appendTo("head")}var t=e("script").last().attr("src"),n,r={title:null,fixed:true,center:true,clone:true,x:0,y:0,modal:true,modalClose:true,resize:true,unload:false,close:"[关闭]",escHide:true,delayClose:0,drag:false,display:true,width:"",height:"",dataEle:"",locate:["left","top"],show:["fadeIn","normal"],hide:["fadeOut","normal"],button:[],style:"default",titleChange:undefined,beforeShow:undefined,afterShow:undefined,afterHide:undefined,beforeUnload:undefined,afterDrag:undefined},i=2013,s=null,o=['<div class="ThinkBox-wrapper" style="position:absolute;width: auto">','<table cellspacing="0" cellpadding="0" border="0" style="width: auto">',"<tr>",'<td class="box-top-left"></td>','<td class="box-top"></td>','<td class="box-top-right"></td>',"</tr>","<tr>",'<td class="box-left"></td>','<td class="ThinkBox-inner"></td>','<td class="box-right"></td>',"</tr>","<tr>",'<td class="box-bottom-left"></td>','<td class="box-bottom"></td>','<td class="box-bottom-right"></td>',"</tr>","</table>","</div>"].join(""),u=['<tr class="ThinkBox-title">','<td class="box-title-left"></td>','<td class="ThinkBox-title-inner"></td>','<td class="box-title-right"></td>',"</tr>"].join(""),a=['<tr class="ThinkBox-tools">','<td class="box-tools-left"></td>','<td class="ThinkBox-tools-inner"></td>','<td class="box-tools-right"></td>',"</tr>"].join(""),f=e(document),l=e(window),c=/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];n=function(t,n){function w(){function t(){n.delayClose&&e.isNumeric(n.delayClose)&&setTimeout(E,n.delayClose);d.call(v,n.afterShow)}if(g)return v;n.modal&&C();d.call(v,n.beforeShow);switch(n.show[0]){case"slideDown":b.stop(true,true).slideDown(n.show[1],t);break;case"fadeIn":b.stop(true,true).fadeIn(n.show[1],t);break;default:b.show(n.show[1],t)}g=true;P();return v}function E(){function t(){g=false;d.call(v,n.afterHide);n.unload&&D()}if(!g)return v;y&&y.fadeOut("normal",function(){e(this).remove();y=null});switch(n.hide[0]){case"slideUp":b.stop(true,true).slideUp(n.hide[1],t);break;case"fadeOut":b.stop(true,true).fadeOut(n.hide[1],t);break;default:b.hide(n.hide[1],t)}return v}function S(){var t=e(u),r=e(".ThinkBox-title-inner",t);if(n.drag){r.addClass("ThinkBox-draging");r[0].onselectstart=function(){return false};r[0].unselectable="on";r[0].style.MozUserSelect="none";A(r)}e("tr",b).first().after(t);x(n.title)}function x(t){var r=e(".ThinkBox-title-inner",b).empty();if(e.isArray(t)||e.isPlainObject(t)){for(key in t){e("<span>"+t[key]+"</span>").data("key",key).click(function(t){var i=e(this);if(!i.hasClass("selected")){r.find("span.selected").removeClass("selected");i.addClass("selected");d.call(i,n.titleChange)}}).mousedown(function(e){e.stopPropagation()}).mouseup(function(e){e.stopPropagation()}).appendTo(r)}}else{r.append("<span>"+t+"</span>")}}function T(){var t=e(a),r=e(".ThinkBox-tools-inner",t),i=null;for(key in n.button){i=e("<span/>").addClass("ThinkBox-button "+n.button[key][0]).html(n.button[key][1]).click(function(){d.call(v,n.button[key][2])}).hover(function(){e(this).addClass("hover")},function(){e(this).removeClass("hover")}).appendTo(r)}e("tr",b).last().before(t)}function N(){e("<span/>").addClass("ThinkBox-close").html(n.close).click(function(e){v.hide();e.stopPropagation()}).mousedown(function(e){e.stopPropagation()}).appendTo(e(".ThinkBox-inner",b))}function C(){if(c[0]){f.width=function(){return document.documentElement.scrollWidth};f.height=function(){return document.documentElement.scrollHeight}}y=e('<div class="ThinkBox-modal-blackout"></div>').addClass("ThinkBox-modal-blackout-"+n.style).css({zIndex:i++,width:f.width(),height:f.height(),position:"absolute",left:0,top:0}).click(function(e){n.modalClose&&s&&s.hide();e.stopPropagation()}).mousedown(function(e){e.stopPropagation()}).appendTo(e("body"));l.resize(function(){y&&y.css({width:"",height:""}).css({width:f.width(),height:f.height()})})}function k(t){var t=e("<div/>").addClass("ThinkBox-content").append((n.clone?e(t).clone(true,true):e(t)).show());e(".ThinkBox-content",b).remove();e(".ThinkBox-inner",b).css({width:n.width,height:n.height}).append(t)}function L(){n.center?O():M(e.isNumeric(n.x)?n.x:e.isFunction(n.x)?n.x.call(e(n.dataEle)):0,e.isNumeric(n.y)?n.y:e.isFunction(n.y)?n.y.call(e(n.dataEle)):0)}function A(e){var t=null;f.mousemove(function(e){t&&b.css({left:e.pageX-t[0],top:e.pageY-t[1]})});e.mousedown(function(e){var r=b.offset();if(n.fixed){r.left-=l.scrollLeft();r.top-=l.scrollTop()}t=[e.pageX-r.left,e.pageY-r.top]}).mouseup(function(){t=null;d.call(v,n.afterDrag)})}function O(){var e=_(),t=p(),n=b.css("position")=="fixed"?[0,0]:[t.left,t.top],r=n[0]+t.width/2,i=n[1]+t.height/2;M(r-e[0]/2,i-e[1]/2)}function M(t,r){e.isNumeric(t)&&(n.locate[0]=="left"?b.css({left:t}):b.css({right:t}));e.isNumeric(r)&&(n.locate[1]=="top"?b.css({top:r}):b.css({bottom:r}))}function _(){var e=[0,0];if(g)e=[b.width(),b.height()];else{b.css({visibility:"hidden",display:"block"});var e=[b.width(),b.height()];b.css("display","none").css("visibility","visible")}return e}function D(){d.call(v,n.beforeUnload);b.remove();n.dataEle&&e(n.dataEle).removeData("ThinkBox")}function P(){s=v;h.call(b)}var v=this,g=false,y=null,n,b;n=e.extend({},r,n||{});m("/skin/"+n.style+"/style.css",function(){b=e(o).addClass("ThinkBox-"+n.style).data("ThinkBox",v);n.dataEle&&e(n.dataEle).data("ThinkBox",v);b.hover(function(){d.call(v,n.mouseover)},function(){d.call(v,n.mouseout)}).mousedown(function(e){P();e.stopPropagation()}).click(function(e){e.stopPropagation()});k(t||"<div></div>");n.title!==null&&S();n.button.length&&T();n.close&&N();b.css("display","none").appendTo("body");b.find(".box-left").append(e("<div/>").css("width",b.find(".box-left").width()));v.hide=E;v.show=w;v.toggle=function(){g?v.hide():v.show()};v.getContent=function(){return e(".ThinkBox-content",b)};v.setContent=function(e){k(e);L();return v};v.setTitle=x;v.getSize=_;v.setSize=function(t,n){e(".ThinkBox-inner",b).css({width:t,height:n})};n.fixed&&(c[0]&&c[1]<7?n.fixed=false:b.css("position","fixed"));L();n.resize&&l.resize(function(){L()});v.escHide=n.escHide;n.display&&w()});};f.mousedown(function(){s=null}).keypress(function(e){s&&s.escHide&&e.keyCode==27&&s.hide()});e.ThinkBox=function(t,r){if(e.isPlainObject(r)&&r.dataEle){var i=e(r.dataEle).data("ThinkBox");if(i)return r.display===false?i:i.show()}return new n(t,r)};e.extend(e.ThinkBox,{load:function(t,n){var r={clone:false,loading:"加载中...",type:"GET",dataType:"text",cache:false,parseData:undefined,onload:undefined},i,s,o,u,a,t=t.split(/\s+/);e.extend(r,n||{});o=r.parseData;u=r.onload;a=r.loading;s={data:r.data,type:r.type,dataType:r.dataType,cache:r.cache,success:function(n){t[1]&&(n=e(n).find(t[1]));e.isFunction(o)&&(n=o.call(r.dataEle,n));i.setContent(n);d.call(i,u);a||i.show()}};v(["data","type","cache","dataType","parseData","onload","loading"],r);i=a?e.ThinkBox('<div class="ThinkBox-load-loading">'+a+"</div>",r):e.ThinkBox("<div/>",e.extend({},r,{display:false}));e.ajax(t[0],s);return i},iframe:function(t,n){var r={width:500,height:400,scrolling:"no",onload:undefined},i,s,o;e.extend(r,n||{});o=r.onload;s=e("<iframe/>").attr({width:r.width,height:r.height,frameborder:0,scrolling:r.scrolling,src:t}).load(function(){d.call(i,o)});v(["width","height","scrolling","onload"],r);i=e.ThinkBox(s,r);return i},tips:function(t,n,r){var i={modalClose:false,escHide:false,unload:true,close:false,delayClose:1e3},s;switch(n){case 0:n="error";break;case 1:n="success";break}s='<div class="ThinkBox-tips ThinkBox-'+n+'">'+t+"</div>";e.extend(i,r||{});return e.ThinkBox(s,i)},success:function(e,t){return this.tips(e,"success",t)},error:function(e,t){return this.tips(e,"error",t)},loading:function(e,t){var n=t||{};n.delayClose=0;return this.tips(e,"loading",n)},msg:function(t,n){var r={drag:false,escHide:false,delayClose:0,center:false,title:"消息",x:0,y:0,locate:["right","bottom"],show:["slideDown","slow"],hide:["slideUp","slow"]},i;e.extend(r,n||{});i=e("<div/>").addClass("ThinkBox-msg").html(t);return e.ThinkBox(i,r)},alert:function(t,n){var r={title:"提示",modal:false,modalClose:false,unload:false},i=["ok","确定",undefined];e.extend(r,n||{});typeof r.okVal!="undefined"&&(i[1]=r.okVal);e.isFunction(r.ok)&&(i[2]=r.ok);v(["okVal","ok"],r);r.button=[i];var s=e("<div/>").addClass("ThinkBox-alert").html(t);return e.ThinkBox(s,r)},confirm:function(t,n){var r={title:"确认",modal:false,modalClose:false},i=[["ok","确定",undefined],["cancel","取消",undefined]];e.extend(r,n||{});typeof r.okVal!="undefined"&&(i[0][1]=r.okVal);typeof r.cancelVal!="undefined"&&(i[1][1]=r.cancelVal);e.isFunction(r.ok)&&(i[0][2]=r.ok);e.isFunction(r.cancel)&&(i[1][2]=r.cancel);v(["okVal","ok","cancelVal","cancel"],r);r.button=i;var s=e("<div/>").addClass("ThinkBox-confirm").html(t);return e.ThinkBox(s,r)},get:function(t){return e(t).closest(".ThinkBox-wrapper").data("ThinkBox")}});e.fn.ThinkBox=function(t){function n(t){var n=this.attr("think-href")||this.attr("href");if(n.substr(0,1)=="#"){e.ThinkBox(n,t)}else if(n.substr(0,7)=="http://"||n.substr(0,8)=="https://"){e.ThinkBox.iframe(n,t)}else{e.ThinkBox.load(n,t)}}if(t=="get")return e(this).data("ThinkBox");return this.each(function(){var r=e(this),i=r.data("ThinkBox"),s,o,u,a,f,l;switch(t){case"show":i&&i.show();break;case"hide":i&&i.hide();break;case"toggle":i&&i.toggle();break;default:s={title:r.attr("title"),dataEle:this,fixed:false,center:false,modal:false,drag:false};t=e.isPlainObject(t)?t:{};e.extend(s,{x:function(){return e(this).offset().left},y:function(){return e(this).offset().top+e(this).outerHeight()}},t);if(s.event){o=s.event;delete s.event;if(o=="hover"){u=s.boxOutClose||false;a=s.delayShow||0;f=null;l=null;v(["boxOutClose","delayShow"],s);s.mouseover=function(){if(l){clearTimeout(l);l=null}};s.mouseout=function(){this.hide()};r.hover(function(){f=f||setTimeout(function(){n.call(r,s)},a)},function(){if(f){clearTimeout(f);f=null}u?l=l||setTimeout(function(){l=null;r.ThinkBox("hide")},50):r.ThinkBox("hide")})}else{r.bind(o,function(){n.call(r,s);return false})}}else{n.call(r,s)}}})}})(jQuery)